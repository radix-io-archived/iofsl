#
# Protocol buffer compilation
#
#
%.pb.cc %.pb.h: %.proto
	$(AM_V_GEN)$(PROTOC) --cpp_out=. $< \
           || ( $(RM) $(@.proto=.cc) $(@.proto=.h); exit 1)

#
# flex & bison deps
# @TODO: get real configure test for flex/bison instead of hoping that yacc
# and lex act like flex and bison
#
# Note: output relative to $@ for VPATH handling
#
%.h %.c: %.ll
	$(AM_V_GEN)$(LEX) --header-file=$(@:.c=.h) -o $(@:.h=.c) $< \
	   || ( $(RM) $(@:.c=.h) $(@:.h=.c).c ; exit 1) 

%.h %.c: %.yy
	$(AM_V_GEN)$(YACC) --defines=$(@:.c=.h) -o $(@:.h=.c)  $< \
	   || ( $(RM) $(@:.c=.h) $(@:.h=.c).c ; exit 1)

#
# Output dist version
#
.phony: distversion
distversion:
	@echo $(VERSION)

#
# Easy way to build unit tests without running them
# 
.phony: tests
tests: $(check_PROGRAMS)
