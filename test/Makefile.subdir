include $(top_srcdir)/test/boost/Makefile.subdir

if BUILD_IOFWD_CLIENT
#
# unit tests build rules
#
if HAVE_CUNIT

test_unit_tests_ldadd =          \
	${top_builddir}/src/zoidfs/libzoidfs-util.a  \
	${top_builddir}/src/iofwdutil/libiofwdutil.a \
	${top_builddir}/src/c-util/libc-util.a       \
    ${top_builddir}/src/zoidfs/libzoidfshints.a \
    @CUNIT_LIBS@                 \
    @ZFS_DISPATCHER_LIBS@ \
    @BMI_LIBS@      

test_unit_tests_ldflags =        \
    @CUNIT_LDFLAGS@              \
    @ZFS_DISPATCHER_LDFLAGS@     \
    @BMI_LDFLAGS@

noinst_PROGRAMS += test/xdrspeed
test_xdrspeed_SOURCES = test/xdr/xdrspeed.cpp
test_xdrspeed_LDADD = src/encoder/libencoder.a \
		      src/iofwdutil/libiofwdutil.a

noinst_PROGRAMS += test/zoidfs-gridftp-test
test_zoidfs_gridftp_test_SOURCES = test/zoidfs-gridftp-test.c
test_zoidfs_gridftp_test_LDADD = src/zoidfs/libzoidfsclient.a ${test_unit_tests_ldadd}
test_zoidfs_gridftp_test_LDFLAGS = ${test_unit_tests_ldflags}

noinst_PROGRAMS += test/unit-tests/zoidfs-md-cunit test/unit-tests/zoidfs-md-cunit-local test/unit-tests/zoidfs-io-cunit \
test/unit-tests/zoidfs-io-cunit-local
if HAVE_ZLIB
test_unit_tests_zoidfs_transform_cunit_SOURCES = test/unit-tests/zoidfs-transform-cunit.c 
test_unit_tests_zoidfs_transform_cunit_LDADD = src/zoidfs/libzoidfsclient.a ${test_unit_tests_ldadd}
test_unit_tests_zoidfs_transform_cunit_LDFLAGS =  ${test_unit_tests_ldflags}
noinst_PROGRAMS += test/unit-tests/zoidfs-transform-cunit
endif
 
test_unit_tests_zoidfs_md_cunit_SOURCES = test/unit-tests/zoidfs-md-cunit.c
test_unit_tests_zoidfs_md_cunit_LDADD = src/zoidfs/libzoidfsclient.a ${test_unit_tests_ldadd}
test_unit_tests_zoidfs_md_cunit_LDFLAGS = ${test_unit_tests_ldflags}
 
test_unit_tests_zoidfs_md_cunit_local_SOURCES = test/unit-tests/zoidfs-md-cunit.c
test_unit_tests_zoidfs_md_cunit_local_LDADD = src/zoidfs/libzoidfs.a ${test_unit_tests_ldadd}
test_unit_tests_zoidfs_md_cunit_local_LDFLAGS = ${test_unit_tests_ldflags}

test_unit_tests_zoidfs_io_cunit_SOURCES = test/unit-tests/zoidfs-io-cunit.c
test_unit_tests_zoidfs_io_cunit_LDADD =  src/zoidfs/libzoidfsclient.a ${test_unit_tests_ldadd}
test_unit_tests_zoidfs_io_cunit_LDFLAGS = ${test_unit_tests_ldflags}
 
test_unit_tests_zoidfs_io_cunit_local_SOURCES = test/unit-tests/zoidfs-io-cunit.c
test_unit_tests_zoidfs_io_cunit_local_LDADD = src/zoidfs/libzoidfs.a ${test_unit_tests_ldadd}
test_unit_tests_zoidfs_io_cunit_local_LDFLAGS = ${test_unit_tests_ldflags}

noinst_PROGRAMS += test/unit-tests/configfile-cunit
test_unit_tests_configfile_cunit_SOURCES = test/unit-tests/configfile-cunit.c
test_unit_tests_configfile_cunit_LDFLAGS = ${test_unit_tests_ldflags}
test_unit_tests_configfile_cunit_LDADD = \
			    ${top_builddir}/src/c-util/libc-util.a \
			    ${test_unit_tests_ldadd}

endif

#
# microbenchmark build rules
#
if HAVE_MPI

test_microbenchmarks_ldadd =     \
    -lm                          \
    ${top_builddir}/src/zoidfs/libzoidfs-util.a  \
    ${top_builddir}/src/iofwdutil/libiofwdutil.a \
    ${top_builddir}/src/zoidfs/libzoidfshints.a \
    ${top_builddir}/src/c-util/libc-util.a       \
    @ZFS_DISPATCHER_LIBS@ @BMI_LIBS@

test_microbenchmarks_ldflags =   \
    @ZFS_DISPATCHER_LDFLAGS@ @BMI_LDFLAGS@

noinst_PROGRAMS += test/zoidfs-microbenchmarks/creat-thput test/zoidfs-microbenchmarks/creat-thput-local \
test/zoidfs-microbenchmarks/mkdir-thput test/zoidfs-microbenchmarks/mkdir-thput-local test/zoidfs-microbenchmarks/lookup-thput \
test/zoidfs-microbenchmarks/lookup-thput-local test/zoidfs-microbenchmarks/getattr-thput test/zoidfs-microbenchmarks/getattr-thput-local \
test/zoidfs-microbenchmarks/setattr-thput test/zoidfs-microbenchmarks/setattr-thput-local test/zoidfs-microbenchmarks/remove-thput \
test/zoidfs-microbenchmarks/remove-thput-local test/zoidfs-microbenchmarks/null-thput test/zoidfs-microbenchmarks/null-thput-local \
test/zoidfs-microbenchmarks/zoidfs-tile-io test/zoidfs-microbenchmarks/zoidfs-tile-io-local

test_zoidfs_microbenchmarks_zoidfs_tile_io_SOURCES = test/zoidfs-microbenchmarks/zoidfs-tile-io.c
test_zoidfs_microbenchmarks_zoidfs_tile_io_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_zoidfs_tile_io_LDFLAGS = ${test_microbenchmarks_ldflags}
test_zoidfs_microbenchmarks_zoidfs_tile_io_CFLAGS = -DHAVE_GETOPT_LONG 
 
test_zoidfs_microbenchmarks_zoidfs_tile_io_local_SOURCES = test/zoidfs-microbenchmarks/zoidfs-tile-io.c
test_zoidfs_microbenchmarks_zoidfs_tile_io_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_zoidfs_tile_io_local_LDFLAGS = ${test_microbenchmarks_ldflags}
test_zoidfs_microbenchmarks_zoidfs_tile_io_local_CFLAGS = -DHAVE_GETOPT_LONG 
 
test_zoidfs_microbenchmarks_creat_thput_SOURCES = test/zoidfs-microbenchmarks/creat-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_creat_thput_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_creat_thput_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_creat_thput_local_SOURCES = test/zoidfs-microbenchmarks/creat-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_creat_thput_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_creat_thput_local_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_null_thput_SOURCES = test/zoidfs-microbenchmarks/null-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_null_thput_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_null_thput_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_null_thput_local_SOURCES = test/zoidfs-microbenchmarks/null-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_null_thput_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_null_thput_local_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_remove_thput_SOURCES = test/zoidfs-microbenchmarks/remove-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_remove_thput_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_remove_thput_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_remove_thput_local_SOURCES = test/zoidfs-microbenchmarks/remove-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_remove_thput_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_remove_thput_local_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_lookup_thput_SOURCES = test/zoidfs-microbenchmarks/lookup-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_lookup_thput_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_lookup_thput_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_lookup_thput_local_SOURCES = test/zoidfs-microbenchmarks/lookup-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_lookup_thput_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_lookup_thput_local_LDFLAGS = ${test_microbenchmarks_ldflags}

test_zoidfs_microbenchmarks_getattr_thput_SOURCES = test/zoidfs-microbenchmarks/getattr-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_getattr_thput_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_getattr_thput_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_getattr_thput_local_SOURCES = test/zoidfs-microbenchmarks/getattr-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_getattr_thput_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_getattr_thput_local_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_setattr_thput_SOURCES = test/zoidfs-microbenchmarks/setattr-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_setattr_thput_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_setattr_thput_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_setattr_thput_local_SOURCES = test/zoidfs-microbenchmarks/setattr-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_setattr_thput_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_setattr_thput_local_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_mkdir_thput_SOURCES = test/zoidfs-microbenchmarks/mkdir-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_mkdir_thput_LDADD = src/zoidfs/libzoidfsclient.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_mkdir_thput_LDFLAGS = ${test_microbenchmarks_ldflags}
 
test_zoidfs_microbenchmarks_mkdir_thput_local_SOURCES = test/zoidfs-microbenchmarks/mkdir-thput.c test/zoidfs-microbenchmarks/thput.h
test_zoidfs_microbenchmarks_mkdir_thput_local_LDADD = src/zoidfs/libzoidfs.a ${test_microbenchmarks_ldadd}
test_zoidfs_microbenchmarks_mkdir_thput_local_LDFLAGS = ${test_microbenchmarks_ldflags}
endif

endif


noinst_PROGRAMS += test/bmi-sm-pingpong
test_bmi_sm_pingpong_SOURCES = test/bmi-sm-pingpong.cpp \
			       test/bmi-sm-pingpong-state.hh \
			       test/bmi-sm-pingpong-state.cpp \
			       test/BMIInit.hh \
			       test/BMILink.hh
test_bmi_sm_pingpong_LDADD = ${top_builddir}/src/sm/libsm.a \
			     ${top_builddir}/src/iofwdevent/libiofwdevent.a \
			     ${top_builddir}/src/iofwdutil/libiofwdutil.a \
				@BOOST_PROGRAM_OPTIONS_LIB@ \
			     @BOOST_REGEX_LIB@ \
			     @BOOST_THREAD_LIB@ \
			     @BOOST_DATE_TIME_LIB@ \
			     @BMI_LIBS@

test_bmi_sm_pingpong_LDFLAGS = @BMI_LDFLAGS@ @BOOST_LDFLAGS@


noinst_PROGRAMS += test/configfile
test_configfile_SOURCES = test/configfile.c
test_configfile_LDADD = ${top_builddir}/src/c-util/libc-util.a 
